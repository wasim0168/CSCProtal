<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRATE FORM 1 - Custom Positioning</title>
    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --bg-color: #e9ecef;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
        }

        /* Form Styling */
        .form-container {
            max-width: 600px;
            margin: 0 auto 30px;
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: 600; 
        }
        
        /* Matching style for input and select */
        input[type="text"], input[type="date"], input[type="file"], select {
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            box-sizing: border-box;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .btn-submit {
            width: 100%; padding: 12px; background-color: #27ae60; color: white;
            border: none; border-radius: 4px; cursor: pointer; font-weight: bold;
        }

        /* PREVIEW WRAPPER */
        .preview-wrapper {
            width: 100%;
            overflow-x: auto;
            display: flex;
            justify-content: center;
            margin-bottom: 50px;
            padding: 20px 0;
            background-color: #525659;
        }

        /* A4 PAGE */
        .a4-page {
            width: 210mm;
            height: 297mm; 
            background: white; 
            position: relative; 
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            overflow: hidden;
            flex-shrink: 0;
            transform-origin: top center;
        }

        /* BACKGROUND IMAGE */
        .a4-bg-image {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: fill;
            z-index: 0;
        }

        /* CONTENT LAYER */
        .content-layer {
            position: relative;
            z-index: 10;
            width: 100%; height: 100%;
        }

        /* ===============================================
           CUSTOM CSS SECTION
           =============================================== */

        .pos-element {
            position: absolute;
        }

        /* --- CARD 1 CSS --- */

        .c1-pan {
            top: 51mm;    left: 92mm;
            font-size: 22px; 
            font-family: Arial 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            
             color: #000;
        }

        .c1-name {
            top: 68mm;    
            left: 65mm;
            font-size: 16px; 
            font-family: Arial 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            color: #000; text-transform: uppercase;
        }

        .c1-father {
            top: 85mm;    
            left: 65mm;
            font-family: Arial 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-size: 16px; 
            color: #000;
        }

        .c1-dob {
            top: 103mm;   
            left: 65mm;
            font-size: 16px; 
            font-family: Arial 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            color: #000;
        }

        /* GENDER ADDED HERE */
        .c1-gender {
            top: 120mm;   left: 65mm; /* Adjusted position below DOB */
            font-size: 16px;             
            font-family: Arial 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            color: #000;
        }

        .c1-photo {
            top: 138.5mm; right: 166mm;
            width: 25mm; height: 31mm;
            object-fit: cover; background: #eee;
        }

        .c1-sign {
            top: 135mm;   left: 66mm;
            width: 50mm;  height: 35mm;
            object-fit: contain;
        }

        .c1-qr {
            top: 138.5mm; right: 52mm;
            width: 30mm;  height: 30mm;
            padding: 2px;
        }


        /* --- CARD 2 CSS --- */

        .c2-pan { 
            top: 249mm;   
            left: 56mm; 
            font-size: 12px; 
            font-family: Arial 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            color: #000000;
        }
        
        .c2-name { 
            top: 261mm;   
            left: 28mm; 
            font-size: 10px; 
            font-family: Arial 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            text-transform: uppercase; 
            color: #000000;
        }
        
        .c2-father { 
            top: 268mm;   
            left: 28mm; 
            font-size: 10px; 
            font-family: Arial 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            color: #000000;
        }
        
        .c2-dob { 
            top: 276.5mm; 
            left: 28mm; 
            font-size: 10px; 
            font-family: Arial 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            color: #000000;
        }

        /* GENDER ADDED HERE */
        .c2-gender {
            top: 284mm;   left: 28mm; /* Adjusted position below DOB */
            font-size: 10px; font-weight: bold; color: #000000;
        }
        
        .c2-photo { 
            top: 242.5mm; right: 167mm; 
            width: 15.5mm; height: 15.5mm; 
            object-fit: cover; border: 1px solid #ffffff; background: #eee; 
        }
        
        .c2-sign { 
            top: 268mm;   right: 140mm; 
            width: 15mm; height: 15.5mm; 
            object-fit: contain; 
        }
        
        .c2-qr { 
            top: 244mm; 
              right: 128.5mm; 
            width: 2px; 
              height: 2px; 
            background: white; padding: 2px; 
        }
        

        /* =============================================== */

        /* Table Styling */
        .table-container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: var(--primary-color); color: white; }
        .btn-print { background-color: #e67e22; color: white; border: none; padding: 5px 10px; cursor: pointer; }

        /* PRINT MEDIA QUERY */
        @media print {
            @page { size: A4; margin: 0; }
            body { background: white; -webkit-print-color-adjust: exact; }
            .form-container, .table-container, h3 { display: none !important; }
            .preview-wrapper { background: white; padding: 0; margin: 0; display: block; overflow: visible; }
            .a4-page { transform: none !important; width: 210mm !important; height: 297mm !important; box-shadow: none; border: none; }
            .a4-bg-image { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .pos-element { border: none !important; }
        }
    </style>
</head>
<body>

    <!-- FORM SECTION -->
    <div class="form-container">
        <h2>CRATE FORM 1</h2>
        <form id="cardForm">
            <label>PAN NO</label>
            <input type="text" id="label1" placeholder="Enter PAN Number" oninput="refreshPreview()">
            
            <label>NAME</label>
            <input type="text" id="label2" placeholder="Enter Full Name" oninput="refreshPreview()">
            
            <label>FATHER NAME</label>
            <input type="text" id="label3" placeholder="Enter Father's Name" oninput="refreshPreview()">
            
            <label>DOB</label>
            <input type="date" id="label4" onchange="refreshPreview()">
            
            <!-- GENDER LABEL ADDED HERE -->
            <label>GENDER</label>
            <select id="label5" onchange="refreshPreview()">
                <option value="">Select Gender</option>
                <option value="MALE">MALE</option>
                <option value="FEMALE">FEMALE</option>
                <option value="OTHER">OTHER</option>
            </select>
            
            <label>UPLOAD PHOTO</label>
            <input type="file" id="photoUpload" accept="image/*" onchange="handleFile(this, 'photo')">
            
            <label>UPLOAD SIGNATURE</label>
            <input type="file" id="signUpload" accept="image/*" onchange="handleFile(this, 'sign')">
            
            <button type="button" class="btn-submit" onclick="submitData()">SUBMIT TO TABLE</button>
        </form>
    </div>

    <!-- PREVIEW SECTION -->
    <div class="preview-section">
        <h3>PREVIEW PAGE</h3>
        <div class="preview-wrapper">
            <div class="a4-page" id="a4Page">
                <!-- Background Image -->
                <img src="pan.jpeg" id="a4-bg" class="a4-bg-image" alt="Background Template">

                <!-- Content Layer -->
                <div class="content-layer">
                    
                    <!-- CARD 1 ELEMENTS -->
                    <span id="c1_pan" class="pos-element c1-pan">PAN NO</span>
                    <span id="c1_name" class="pos-element c1-name">NAME</span>
                    <span id="c1_father" class="pos-element c1-father">FATHER NAME</span>
                    <span id="c1_dob" class="pos-element c1-dob">DOB</span>
                    <!-- GENDER PREVIEW ADDED -->
                    <span id="c1_gender" class="pos-element c1-gender">MALE</span>
                    
                    <img id="c1_photo" class="pos-element c1-photo" src="https://via.placeholder.com/100?text=PHOTO">
                    <img id="c1_sign" class="pos-element c1-sign" src="https://via.placeholder.com/150x50?text=SIGN" style="display:none;">
                    <div id="c1_qr" class="pos-element c1-qr"></div>

                    <!-- CARD 2 ELEMENTS -->
                    <span id="c2_pan" class="pos-element c2-pan">PAN NO</span>
                    <span id="c2_name" class="pos-element c2-name">NAME</span>
                    <span id="c2_father" class="pos-element c2-father">FATHER NAME</span>
                    <span id="c2_dob" class="pos-element c2-dob">DOB</span>
                    <!-- GENDER PREVIEW ADDED -->

                    <img id="c2_photo" class="pos-element c2-photo" src="https://via.placeholder.com/100?text=PHOTO">
                    <img id="c2_sign"   class="pos-element c2-sign" src="https://via.placeholder.com/150x50?text=SIGN" style="display:none;">
                    <div id="c2_qr" class="pos-element c2-qr"></div>

                </div>
            </div>
        </div>
    </div>

    <!-- TABLE SECTION -->
    <div class="table-container">
        <h3>Submitted Records</h3>
        <table>
            <thead>
                <tr>
                    <th>SR</th>
                    <th>NAME</th>
                    <th>PAN NO</th>
                    <th>PDF PRINT</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <script>
let records = [];
let serialNo = 1;
let currentPhoto = null;
let currentSign = null;

/* ðŸ”¥ DOB FORMAT FUNCTION */
function formatDateIndian(dateValue) {
    if (!dateValue) return "DD/MM/YYYY";
    const parts = dateValue.split("-");
    return `${parts[2]}/${parts[1]}/${parts[0]}`;
}

function scaleA4Page() {
    const wrapper = document.querySelector('.preview-wrapper');
    const page = document.querySelector('.a4-page');
    if (!wrapper || !page) return;

    const wrapperWidth = wrapper.clientWidth - 40; 
    const pageWidth = page.offsetWidth;

    if (wrapperWidth < pageWidth) {
        const scale = wrapperWidth / pageWidth;
        page.style.transform = `scale(${scale})`;
        const heightDiff = page.offsetHeight * (1 - scale);
        page.style.marginBottom = `-${heightDiff}px`;
    } else {
        page.style.transform = 'scale(1)';
        page.style.marginBottom = '0';
    }
}

window.onload = function() {
    refreshPreview();
    scaleA4Page();
};
window.onresize = scaleA4Page;

function handleFile(input, type) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            if (type === 'photo') {
                currentPhoto = e.target.result;
                document.getElementById('c1_photo').src = currentPhoto;
                document.getElementById('c2_photo').src = currentPhoto;
            }
            if (type === 'sign') {
                currentSign = e.target.result;
                document.getElementById('c1_sign').src = currentSign;
                document.getElementById('c1_sign').style.display = 'block';
                document.getElementById('c2_sign').src = currentSign;
                document.getElementById('c2_sign').style.display = 'block';
            }
        }
        reader.readAsDataURL(input.files[0]);
    }
}

function refreshPreview() {
    const pan = document.getElementById('label1').value || "PAN NO";
    const name = document.getElementById('label2').value || "NAME";
    const father = document.getElementById('label3').value || "FATHER NAME";
    const dobRaw = document.getElementById('label4').value;
    const dob = formatDateIndian(dobRaw);
    const gender = document.getElementById('label5').value || "MALE";

    // Card 1
    document.getElementById('c1_pan').innerText = pan;
    document.getElementById('c1_name').innerText = name;
    document.getElementById('c1_father').innerText = father;
    document.getElementById('c1_dob').innerText = dob;
    document.getElementById('c1_gender').innerText = gender;

    // Card 2
    document.getElementById('c2_pan').innerText = pan;
    document.getElementById('c2_name').innerText = name;
    document.getElementById('c2_father').innerText = father;
    document.getElementById('c2_dob').innerText = dob;

    // QR Data with formatted DOB
    const qrData = `${pan}|${name}|${father}|${dob}|${gender}`;

    document.getElementById('c1_qr').innerHTML = "";
    document.getElementById('c2_qr').innerHTML = "";

    try {
        new QRCode(document.getElementById("c1_qr"), { text: qrData, width: 100, height: 100 });
        new QRCode(document.getElementById("c2_qr"), { text: qrData, width: 80, height: 80 });
    } catch(e) {}

    setTimeout(scaleA4Page, 50);
}

function submitData() {
    const pan = document.getElementById('label1').value;
    const name = document.getElementById('label2').value;

    if (!pan || !name || !currentPhoto || !currentSign) {
        alert("Please fill all fields and upload Photo & Signature.");
        return;
    }

    const recordData = {
        pan: pan,
        name: name,
        father: document.getElementById('label3').value,
        dob: formatDateIndian(document.getElementById('label4').value),
        gender: document.getElementById('label5').value,
        photo: currentPhoto,
        sign: currentSign
    };

    records.push(recordData);

    const tbody = document.getElementById('tableBody');
    const row = document.createElement('tr');
    row.innerHTML = `
        <td>${serialNo}</td>
        <td>${recordData.name}</td>
        <td>${recordData.pan}</td>
        <td><button class="btn-print" onclick="printRecord(${serialNo - 1})">PDF PRINT</button></td>
    `;
    tbody.appendChild(row);
    serialNo++;

    document.getElementById('cardForm').reset();
    currentPhoto = null;
    currentSign = null;

    document.getElementById('c1_photo').src = "https://via.placeholder.com/100?text=PHOTO";
    document.getElementById('c2_photo').src = "https://via.placeholder.com/100?text=PHOTO";
    document.getElementById('c1_sign').style.display = 'none';
    document.getElementById('c2_sign').style.display = 'none';

    refreshPreview();
    document.querySelector('.table-container').scrollIntoView({behavior: 'smooth'});
}

function printRecord(index) {
    const data = records[index];

    document.getElementById('c1_pan').innerText = data.pan;
    document.getElementById('c1_name').innerText = data.name;
    document.getElementById('c1_father').innerText = data.father;
    document.getElementById('c1_dob').innerText = data.dob;
    document.getElementById('c1_gender').innerText = data.gender || "";
    document.getElementById('c1_photo').src = data.photo;
    document.getElementById('c1_sign').src = data.sign;
    document.getElementById('c1_sign').style.display = 'block';

    document.getElementById('c2_pan').innerText = data.pan;
    document.getElementById('c2_name').innerText = data.name;
    document.getElementById('c2_father').innerText = data.father;
    document.getElementById('c2_dob').innerText = data.dob;
    document.getElementById('c2_photo').src = data.photo;
    document.getElementById('c2_sign').src = data.sign;
    document.getElementById('c2_sign').style.display = 'block';

    const qrData = `${data.pan}|${data.name}|${data.father}|${data.dob}|${data.gender}`;

    document.getElementById('c1_qr').innerHTML = "";
    document.getElementById('c2_qr').innerHTML = "";

    new QRCode(document.getElementById("c1_qr"), { text: qrData, width: 100, height: 100 });
    new QRCode(document.getElementById("c2_qr"), { text: qrData, width: 80, height: 80 });

    window.print();
}
</script>
</body>
</html>